<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="区块链技术入门"><meta name="keywords" content="密码学,网络安全,网络"><meta name="author" content="GiyaYon"><meta name="copyright" content="GiyaYon"><title>区块链技术入门 | GiyaYon's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.3.0'
} </script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="GiyaYon's Blog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">第一章 区块链概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%8A%80%E6%9C%AF%E7%89%B9%E7%82%B9"><span class="toc-number">2.1.</span> <span class="toc-text">1.技术特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%82%A8%E5%AD%98"><span class="toc-number">2.1.1.</span> <span class="toc-text">1.储存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E5%85%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.安全</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-0%E8%B4%A7%E5%B8%81"><span class="toc-number">2.1.3.</span> <span class="toc-text">1.0货币</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-0-%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.0 智能合约</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BB%93%E6%9E%84%E5%B1%82%E6%AC%A1"><span class="toc-number">2.2.</span> <span class="toc-text">3.结构层次</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E5%B1%82"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.数据层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.网络层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%85%B1%E8%AF%86%E5%B1%82"><span class="toc-number">2.2.3.</span> <span class="toc-text">3.共识层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%BF%80%E5%8A%B1%E5%B1%82"><span class="toc-number">2.2.4.</span> <span class="toc-text">4.激励层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%90%88%E7%BA%A6%E5%B1%82"><span class="toc-number">2.2.5.</span> <span class="toc-text">5.合约层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-number">2.2.6.</span> <span class="toc-text">6.应用层</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.</span> <span class="toc-text">4.总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">第二章 区块链的密码学基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">第三章 区块链的网络协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">第四章 共识算法</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">第五章 智能合约</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">第六章 比特币</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%B4%A7%E5%B8%81"><span class="toc-number">7.1.</span> <span class="toc-text">1.货币</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%92%B1%E5%8C%85"><span class="toc-number">7.2.</span> <span class="toc-text">2.钱包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D"><span class="toc-number">7.2.1.</span> <span class="toc-text">数字签名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E9%92%B1%E5%8C%85"><span class="toc-number">7.2.2.</span> <span class="toc-text">支付钱包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BA%A4%E6%98%93"><span class="toc-number">7.3.</span> <span class="toc-text">3.交易</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BA%A4%E6%98%93%E7%A1%AE%E8%AE%A4%E4%B8%8E%E5%86%99%E5%85%A5%E5%8C%BA%E5%9D%97%E9%93%BE"><span class="toc-number">7.4.</span> <span class="toc-text">4.交易确认与写入区块链</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%9F%BF%E5%B7%A5%E6%8C%96%E7%9F%BF"><span class="toc-number">7.5.</span> <span class="toc-text">5.矿工挖矿</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E7%BB%AD%E8%B4%B9"><span class="toc-number">7.5.1.</span> <span class="toc-text">手续费</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E7%82%B9%E5%AF%B9%E7%82%B9%E7%BD%91%E7%BB%9C"><span class="toc-number">7.6.</span> <span class="toc-text">6.点对点网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-UTXO%E6%A8%A1%E5%9E%8B"><span class="toc-number">7.7.</span> <span class="toc-text">7.UTXO模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">第七章 以太坊</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">第八章 Hyperledger Fabric</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">后言</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://raw.githubusercontent.com/GiyaYon/mypicGo/master/header.jpg"></div><div class="author-info__name text-center">GiyaYon</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/GiyaYon">查看项目</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">7</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">10</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">GiyaYon's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a><a class="site-page" href="/github">GitHub</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">区块链技术入门</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-03-20</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B/">网络工程</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E7%A8%8B/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1>前言</h1>
<p>区块链已经成为构建信任的新技术基础设施，通过深度融合密码学、对等网络、共识算法、智能合约等技术进行集成创新，即实现了更广泛的社会协作，又降低了社会的信号成本。第一章为概述，宏观上介绍区块链基础知识，第二到五章分别介绍区块链的核心技术，包括区块链的密码学基础、网络协议、共识算法、智能合约等。第六到八章详解典型的区块链技术实践平台，比特币、以太坊等。</p>
<p>2023/3/20</p>
<h1>第一章 区块链概述</h1>
<h2 id="1-技术特点">1.技术特点</h2>
<ul>
<li>分布式一致</li>
<li>密码算法</li>
<li>对等网络</li>
<li>数据库</li>
<li>货币竞争化</li>
</ul>
<h3 id="1-储存">1.储存</h3>
<p>区块链的主要作用是储存信息。任何需要保存的信息，都可以写入区块链，也可以从里面读取，它很像数据库，你可以向任何一个节点，写入/读取数据，因为所有节点最后都会同步，保证区块链一致，但缺点在于它只能增加，和查询，却不能实现修改和删除。</p>
<p>区块链没有管理员，是一个去中心化的应用。任何人都可以架设服务器，加入区块链网络，成为一个节点。区块链的世界里面，没有中心节点，每个节点都是平等的，都保存着整个数据库。</p>
<h3 id="2-安全">2.安全</h3>
<p>区块链是由一个个区块节点组成，一个区块分为头和体，头数据记录着当前区块的多个特征值，体记录着保护的数据。</p>
<p>头记录着该区块的特征，比如这个区块的生成时间，上一个区块的头数据，头数据通过 <mark>SHA256</mark> 加密出一段哈希值，因为一个区块连着上一个区块，如果改本区块的内容，那么后面的区块也随之改变，发布到全网自然会被淘汰掉，所以实现了不可篡改的要求。</p>
<pre><code>## 2.历史发展
</code></pre>
<h3 id="1-0货币">1.0货币</h3>
<p>1.全网共享账本：不易攻破系统</p>
<p>2.块链式结构：加密有序</p>
<h3 id="2-0-智能合约">2.0 智能合约</h3>
<p>在隔离沙箱中运行契约程序</p>
<h2 id="3-结构层次">3.结构层次</h2>
<p>定义：狭义上按时间顺序连续区块组成一种数据结构，以密码学保证不可篡改伪造功能的分布式账本；广义上利用块链式数据结构验证存储数据利用分布式节点共识算法生成更新数据，利用密码学保证安全，利用自动化来编程与操作数据的分布式基础架构与计算范求。</p>
<p>应用层 开发应用工程开发工具</p>
<p>合约层 智能合约编程语言，沙箱</p>
<p>激励层 发行货币，分配机制</p>
<p>共识层 Pow，Pos共识算法</p>
<p>网络层 拓扑结构，传播</p>
<p>数据层 区块数据与加密</p>
<h3 id="1-数据层">1.数据层</h3>
<p>有区块结构、链结构、交易结构，通过链式结构链接以时间戳顺序打包区块结构实现不可篡改。交易结构就是基本的数据结构，记录交易的双方基本交易信息。</p>
<h3 id="2-网络层">2.网络层</h3>
<p>网络拓扑结构，区块或交易等数据协议和验证机制。在节点生成后时刻监听广播与数据，验证是否有效，检查后才加入区块</p>
<h3 id="3-共识层">3.共识层</h3>
<p>全网存储一致性：共识算法，避免区块生成过快，通过节点证明能力获得记账权的共识与难度变动的共识算法。在一定认可后确定生成区块并给予一定的奖励。</p>
<h3 id="4-激励层">4.激励层</h3>
<p>经济激励的发行于分配机制，例如发行货币是否有上限，挖矿奖励的分配</p>
<h3 id="5-合约层">5.合约层</h3>
<p>智能合约由编程语言，沙箱环境以及外部输入正确信息的预言机组成，是一段运行在安全环境的计算机程序。</p>
<p>该合约不可篡改，只能升级，就是生成新区块部署。</p>
<p>合约的生命周期：创建开发、部署运行、升级、销毁。</p>
<h3 id="6-应用层">6.应用层</h3>
<p>定义区块链应用的准则模型，垂直行业以及开发工具等。</p>
<h2 id="4-总结">4.总结</h2>
<p>分布式、密码算法、网络协议构成区块链的基础，共识算法到后来的智能合约在比特币以太坊中有所扩展，数据库存储电子货币都有所应用。</p>
<h1>第二章 区块链的密码学基础</h1>
<h1>第三章 区块链的网络协议</h1>
<h1>第四章 共识算法</h1>
<h1>第五章 智能合约</h1>
<h1>第六章 比特币</h1>
<h2 id="1-货币">1.货币</h2>
<p>​	数字货币是基于数学加密原理构建的不可伪造的货币系统，而比特币是第一个基于数学加密原理构建的分布式数字货币系统。比特币和区块链有什么关系？一句话概括，比特币使用区块链技术实现了数字货币的可信支付。</p>
<p>​	说起货币，我们想到的就是日常生活中使用的纸币。但是，纸币并不是天生就出现的。如果追溯到三千多年前，人类社会并没有任何货币，部落之间的贸易是物物交换。随着经济和贸易的发展，迫切需要一种“<strong>一般等价物</strong>”来作为商品交换的“中介”，这种一般等价物就是货币。最早的货币是贝壳，后来由于金属冶炼技术的进步，出现了铜、铁铸造的货币。金属货币由于体积小，容易分割和铸造，逐渐获得了广泛的使用。最终，世界各国的金属货币都落到了金、银这几种<strong>贵金属</strong>上。</p>
<p>​	随着经济的继续发展，<strong>金属货币因为沉重并且不易携带</strong>，因此，人们发明了纸币。世界上最早的纸币出现在中国宋朝，称为“交子”。纸币的发行机制决定了必须由政府发行，并且强行推广使用，因此纸币又称法币。</p>
<p>​	随着计算机技术的发展，银行系统经过几十年的发展，已经用计算机系统完全代替了人工记账，纸币也实现了<strong>电子化</strong>。现在，我们可以自由地使用网银、支付宝这样的工具实现随时随地转账付款，就得益于纸币的电子化和网络化。</p>
<p>​	电子货币本质上仍然是法币，它仍然是由<strong>央行发行</strong>，只是以计算机技术把货币以实体纸币形式的流通变成了银行计算机系统的存款。和纸币相比，电子货币具有更高的流动性。我们每天使用的网上银行、支付宝、微信支付等，都是这种方式。</p>
<p>​	而比特币作为一种数字货币，它和电子货币不同的是，比特币<strong>不需要一个类似银行的中央信任机构</strong>，就可以通过全球P2P网络进行发行和流通，这一点听上去有点不可思议，但比特币正是一种通过密码学理论建立的不可伪造的货币系统。</p>
<p>​	总的来说，比特币具有以下特点：</p>
<ul>
<li>创建了无需信任中心的货币发行机制；</li>
<li>发行数量由程序决定，无法随意修改；</li>
<li>交易账本完全公开可追溯，不可篡改；</li>
<li>密码学理论保证货币防伪造，防双花；</li>
<li>数字签名机制保证交易完整可信，不可抵赖和撤销。</li>
</ul>
<h2 id="2-钱包">2.钱包</h2>
<p>比特币的交易是一种无需信任中介参与的P2P（Peer-to-peer）交易。</p>
<h3 id="数字签名">数字签名</h3>
<p>​	传统的电子交易，交易双方必须通过银行这样的信任机构作为中介，这样可以保证交易的安全性，因为银行记录了交易双方的账户资金，能保证在一笔交易中，要么保证成功，要么交易无效，不存在一方到账而另一方没有付款的情况；</p>
<p>​	但是在比特币这种去中心化的P2P网络中，并<strong>没有</strong>一个类似银行这样的<strong>信任机构</strong>存在，要想在两个节点之间达成交易，就必须实现一种在零信任的情况下安全交易的机制。</p>
<p>​	假设有两个人，一个叫小明，一个叫小红，小明说：“我转一万块给小红！”。如何验证这个声明确实是小明作出的呢？数字签名就可以验证这个声明是否是小明做的，并且，一旦验证通过，小明是无法抵赖的。</p>
<p>在比特币交易中，付款方就是通过数字签名来证明自己拥有某一笔比特币，并且，要把这笔比特币转移给指定的收款方。使用签名是为了验证某个声明确实是由某个人做出的。例如，在付款合同中签名，可以通过验证笔迹的方式核对身份。而在计算机中，用密码学理论设计的数字签名算法比验证笔迹更加可信。使用数字签名时，每个人都可以自己生成一个秘钥对，这个秘钥对包含一个私钥和一个公钥：私钥被称为Secret Key或者Private Key，私钥必须严格保密，不能泄漏给其他人；公钥被称为Public Key，可以公开给任何人；</p>
<p>当私钥持有人，例如，小明希望对某个消息签名的时候，他可以用自己的私钥对消息进行签名，然后，把消息、签名和自己的公钥发送出去；其他任何人都可以通过小明的公钥对这个签名进行验证，如果验证通过，可以肯定，该消息是小明发出的。</p>
<p>数字签名算法在电子商务、在线支付这些领域有非常重要的作用：</p>
<ul>
<li>首先，签名不可伪造，因为私钥只有签名人自己知道，所以其他人无法伪造签名。</li>
<li>其次，消息不可篡改，如果原始消息被人篡改了，那么对签名进行验证将失败。</li>
<li>最后，签名不可抵赖。如果对签名进行验证通过了，那么，该消息肯定是由签名人自己发出的，他不能抵赖自己曾经发过这一条消息。</li>
</ul>
<h3 id="支付钱包">支付钱包</h3>
<p>对于比特币来说，钱不是支付给个人的，而是支付给某一把私钥。这就是交易匿名性的根本原因，因为没有人知道，那些私钥背后的主人是谁。所以，<strong>比特币交易的第一件事，就是你必须拥有自己的公钥和私钥。</strong></p>
<p>​	首先生成一个比特币钱包（wallet）。<strong>这个钱包不是用来存放比特币，而是存放你的公钥和私钥。<strong>软件会帮你生成这两把钥匙，然后放在钱包里面。根据协议，公钥的长度是512位。这个长度不太方便传播，因此协议又规定，要为</strong>公钥生成一个160位的</strong><mark>指纹</mark>。所谓指纹，就是一个比较短的、易于传播的哈希值。160位是二进制，写成十六进制，大约是26到35个字符，比如 1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2。这个字符串就叫做<strong>钱包的地址</strong>，它是唯一的，即每个钱包的地址肯定都是不一样的。</p>
<p>​	你向别人收钱时，只要告诉对方你的钱包地址即可，对方向这个地址付款。由于你是这个地址的拥有者，所以你会收到这笔钱。</p>
<p><strong>由于你是否拥有某个钱包地址，是由私钥证明</strong>的（具体的证明方法稍后介绍），所以一定要保护好私钥。这是极其重要的，如果你的私钥被偷了，你的比特币也就等于没了，因为他人可以冒用你的身份了，把钱包里面的钱都转走。</p>
<p>同样的，你向他人支付比特币，千万不能写错他人的钱包地址，否则你的比特币就支付到了另一个不同的人了。</p>
<h2 id="3-交易">3.交易</h2>
<p>​	比特币实际的交易记录是由一系列交易构成，每一个交易都包含一个或多个输入，以及一个或多个输出。未花费的输出被称为UTXO（Unspent Transaction Ouptut）。</p>
<p>**一笔交易就是一个地址的比特币，转移到另一个地址。**由于比特币的交易记录全部都是公开的，哪个地址拥有多少比特币，都是可以查到的。因此，支付方是否拥有足够的比特币，完成这笔交易，这是可以轻易验证的。</p>
<p>问题出在怎么防止其他人，冒用你的名义申报交易。举例来说，有人申报了一笔交易：地址 A 向地址 B 支付10个比特币。我怎么知道这个申报是真的，申报人就是地址 A 的主人？</p>
<p>比特币协议规定，申报交易的时候，除了交易金额，<strong>转出比特币的一方</strong>还必须提供以下数据。</p>
<blockquote>
<ul>
<li>上一笔交易的 Hash（你从哪里得到这些比特币）</li>
<li>本次交易双方的地址，支付方的地址</li>
<li>支付方的公钥</li>
<li>支付方的私钥生成的数字签名</li>
</ul>
</blockquote>
<p>验证这笔交易是否属实，需要三步。</p>
<blockquote>
<p>第一步，找到上一笔交易，确认支付方的比特币来源。算出他的资产是否足够支付这场交易</p>
<p>第二步，算出支付方公钥的指纹，确认与支付方的地址一致，从而保证公钥属实。</p>
<p>第三步，使用支付方公钥去解开数字签名，保证私钥属实。</p>
</blockquote>
<p>经过上面三步，就可以认定这笔交易是真实的。</p>
<h2 id="4-交易确认与写入区块链">4.交易确认与写入区块链</h2>
<p>确认交易的真实性以后，交易还不算完成。<strong>交易数据必须写入数据库，才算成立，对方才能真正收到钱。</strong></p>
<p>比特币使用的是一种特殊的数据库，叫做区块链（blockchain），详细的介绍请看<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html">《区块链入门教程》</a>。本文只讨论交易如何写入区块链。</p>
<p>首先，所有的交易数据都会传送到矿工那里。矿工负责把这些交易写入区块链。</p>
<p>根据比特币协议，一个区块的大小最大是 1MB，而一笔交易大概是500字节左右，因此一个区块最多可以包含2000多笔交易。矿工负责把这2000多笔交易打包在一起，组成一个区块，然后计算这个区块的哈希。</p>
<p>计算哈希的过程叫做采矿，这需要大量的计算。矿工之间也在竞争，谁先算出哈希，谁就能第一个添加新区块进入区块链，从而享受这个区块的全部收益，而其他矿工将一无所获。</p>
<p>一笔交易一旦写入了区块链，就无法反悔了。这里需要建立一个观念：**比特币不存放在钱包或其他别的地方，而是只存在于区块链上面。**区块链记载了你参与的每一笔交易，你得到过多少比特币，你又支付了多少比特币，因此可以算出来你拥有多少资产。</p>
<h2 id="5-矿工挖矿">5.矿工挖矿</h2>
<p>​	当某个矿工成功找到特定哈希的新区块后，他会立刻向全网<strong>广播该区块</strong>。其他矿工在收到新区块后，会对新区块进行验证，如果有效，就把它添加到区块链的尾部。同时说明，在本轮工作量证明的竞争中，这个矿工胜出，而其他矿工都失败了。失败的矿工会抛弃自己当前正在计算还没有算完的区块，转而开始计算下一个区块，进行下一轮工作量证明的竞争。</p>
<p>为什么区块可以安全广播？因为Merkle Hash锁定了该区块的所有交易，而该区块的第一个coinbase交易输出地址是该矿工地址。每个矿工在挖矿时产生的区块数据都是不同的，所以无法窃取别人的工作量。</p>
<p>​	在比特币的P2P网络中，有一类节点，它们时刻不停地进行计算，试图把新的交易打包成新的区块并附加到区块链上，这类节点就是矿工。因为每打包一个新的区块，打包该区块的矿工就可以获得一笔比特币作为奖励。所以，打包新区块就被称为挖矿。</p>
<p>​	比特币的挖矿原理就是一种工作量证明机制。<strong>工作量证明POW</strong>是英文Proof of Work的缩写。</p>
<p>​	如果两个矿工在同一时间各自找到了有效区块，注意，这两个区块是不同的，因为coinbase交易不同，所以Merkle Hash不同，区块哈希也不同。但它们只要符合难度值，就都是有效的。这个时候，网络上的其他矿工应该接收哪个区块并添加到区块链的末尾呢？答案是，都有可能。</p>
<p>​	通常，矿工接收先收到的有效区块，由于P2P网络广播的顺序是不确定的，不同的矿工先收到的区块是有可能的不同的。这个时候，我们说区块发生了分叉：在分叉的情况下，有的矿工在绿色的分叉上继续挖矿，有的矿工在蓝色的分叉上继续挖矿：但是最终，总有一个分叉首先挖到后续区块，这个时候，由于比特币网络采用<mark>最长分叉的共识算法</mark>，绿色分叉胜出，蓝色分叉被废弃，整个网络上的所有矿工又会继续在最长的链上继续挖矿。由于区块链虽然最终会保持数据一致，但是，一个交易可能被打包到一个后续被孤立的区块中。所以，要确认一个交易被永久记录到区块链中，需要对交易进行确认。如果后续的区块被追加到区块链上，实际上就会对原有的交易进行确认，因为链越长，修改的难度越大。一般来说，经过6个区块确认的交易几乎是不可能被修改的。</p>
<h3 id="手续费">手续费</h3>
<p>​	交易的确认离不开矿工。为什么有人愿意做矿工呢？比特币协议规定，挖到新区块的矿工将获得奖励，一开始（2008年）是50个比特币，然后每4年减半，目前（2018年）是12.5个比特币。这也是比特币的<strong>供给增加机制</strong>，流通中新增的比特币都是这样诞生的。你可能看出来了，每4年奖励减半，由于比特币可以分割到小数点后八位，那么到了2140年，矿工将得不到任何奖励，比特币的数量也将停止增加。这时，矿工的收益就完全依靠交易手续费了。</p>
<p>所谓交易手续费，就是矿工可以从每笔交易抽成，具体的金额由支付方自愿决定。你完全可以一毛不拔，一分钱也不给矿工，但是那样的话，你的交易就会没人处理，迟迟无法写入区块链，得到确认。矿工们总是优先处理手续费最高的交易。</p>
<p>目前由于交易数量猛增，手续费已经水涨船高，一个区块2000多笔交易的手续费总额可以达到3～10个比特币。如果你的手续费给低了，很可能过了一个星期，交易还没确认。</p>
<h2 id="6-点对点网络">6.点对点网络</h2>
<p>比特币是一个全世界的开放网络，只要你有服务器，就能加入这个网络，成为一个节点。每个节点都包含了整个区块链（目前2018大概 100多 GB），并且节点之间时刻不停地在同步信息。当你发生了一笔支付，你所在的节点就会把这笔交易告诉另一个节点，直至传遍整个网络。矿工从网上收集各种新发生的交易，将它们打包写入区块链。一旦写入成功， 矿工所在节点的区块链，就成为最新版本，其他节点都会来复制新增的区块，保证全网的区块链都是一致的。</p>
<p>最后，你所在的节点也拿到了最新的区块链，从而得知你早先的那笔交易，已经写在里面了，至此交易确认成功。</p>
<h2 id="7-UTXO模型">7.UTXO模型</h2>
<p>比特币的区块链由一个个区块串联构成，而每个区块又包含一个或多个交易。</p>
<p>如果我们观察任何一个交易，它总是由若干个输入（Input）和若干个输出（Output）构成，一个Input指向的是前面区块的某个Output，只有Coinbase交易（矿工奖励的铸币交易）没有输入，只有凭空输出。所以，任何交易，总是可以由Input溯源到Coinbase交易。</p>
<p>还没有被下一个交易花费的Output被称为UTXO：Unspent TX Output，即未花费交易输出。给定任何一个区块，计算当前所有的UXTO金额之和，等同于自创世区块到给定区块的挖矿奖励之和。</p>
<p>因此，比特币的交易模型和我们平时使用的银行账号有所不同，它并没有账户这个说法，只有UTXO。想要确定某个人拥有的比特币，并无法通过某个账户查到，必须知道此人控制的所有UTXO金额之和。</p>
<p>在钱包程序中，钱包管理的是一组私钥，对应的是一组公钥和地址。钱包程序必须从创世区块开始扫描每一笔交易，如果：</p>
<ol>
<li>遇到某笔交易的某个Output是钱包管理的地址之一，则钱包余额增加；</li>
<li>遇到某笔交易的某个Input是钱包管理的地址之一，则钱包余额减少。</li>
</ol>
<p>钱包的当前余额总是钱包地址关联的所有UTXO金额之和。</p>
<p>如果刚装了一个新钱包，导入了一组私钥，在钱包扫描完整个比特币区块之前，是无法得知当前管理的地址余额的。</p>
<p>那么，给定一个地址，要查询该地址的余额，难道要从头扫描几百GB的区块链数据？</p>
<p>当然不是。</p>
<p>要做到瞬时查询，我们知道，使用关系数据库的主键进行查询，由于用了索引，速度极快。</p>
<p>把MySQL的binlog日志完整地记录下来，再进行重放，即可在另一台机器上完整地重建整个数据库。把区块链看作不可修改的binlog日志，我们只要把每个区块的所有交易重放一遍，即可重建一个地址-余额的数据库。</p>
<p>可见，比特币的区块链记录的是修改日志，而不是当前状态。</p>
<h1>第七章 以太坊</h1>
<p>以太坊（Ethereum）是一个支持智能合约的区块链平台，它与比特币最大的不同是，以太坊通过一个虚拟机（EVM）可以运行智能合约。</p>
<h1>第八章 Hyperledger Fabric</h1>
<h1>后言</h1>
<p>相关技术文章：</p>
<p><a target="_blank" rel="noopener" href="https://bitcoin.org/bitcoin.pdf">https://bitcoin.org/bitcoin.pdf</a>  比特币：一种点对点的电子现金系统/中本聪/2008.10</p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html">https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html</a> 比特币入门教程/阮一峰/2018.1.4</p>
<p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html">https://www.ruanyifeng.com/blog/2017/12/blockchain-tutorial.html</a> 区块链入门教程/阮一峰/2017.12.26</p>
<p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1207298049439968">https://www.liaoxuefeng.com/wiki/1207298049439968</a> 区块链教程/廖雪峰/2018.4.10</p>
<p>《区块链技术与实践》朱建民 机械工业出版社.2021</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">GiyaYon</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://giyayonlib.com/2023/03/20/区块链技术与实践/">http://giyayonlib.com/2023/03/20/区块链技术与实践/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/">密码学</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/">网络</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/03/28/%E5%AE%89%E5%8D%93%E7%A7%BB%E5%8A%A8%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/"><i class="fa fa-chevron-left">  </i><span>Android企业级开发概述</span></a></div><div class="next-post pull-right"><a href="/2023/03/11/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%BD%9C%E4%B8%9A%E9%A2%98/"><span>网络安全渗透测试作业题</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2023 By GiyaYon</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>